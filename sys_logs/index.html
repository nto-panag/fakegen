<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>AttPl-Special Edition</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.min.js"></script>
    <style>
        body { background: #d2c09e; background-image: url('bg-tile.jpg'); background-repeat: repeat; color: #3e2723; font-family: 'Segoe UI', Tahoma, sans-serif; padding: 10px; font-size: 16px; } 
        .container { max-width: 90%; width: 980px; margin: 20px auto; background: rgba(252, 244, 230, 0.96); padding: 15px; border: 2px solid #8b4513; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .header-feng { text-align: center; margin-bottom: 15px; background: #8b4513; color: white; padding: 8px; border-radius: 5px; }
        .header-feng h2 { margin: 0; font-size: 16px; }
        #date_display { text-align: center; font-weight: bold; font-size: 16px; color: #196649; margin-bottom: 15px; }
        .inline-row { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; border-top: 2px solid #8b4513; padding-top: 10px; font-weight: bold; font-size: 13px; flex-wrap: wrap; justify-content: center; }
        .small-input { width: 35px !important; text-align: center; border: 1px solid #8b4513; }
        .sleep-select { border: 1px solid #d63384; background: #fff0f5; font-weight: bold; color: #d63384; border-radius: 4px; }
        textarea { width: 100%; height: 250px; border: 1px solid #8b4513; font-family: monospace; font-size: 14px; padding: 10px; box-sizing: border-box; resize: vertical; overflow-y: auto; }
        .btn-calc { background-color: #43b581; color: white; padding: 10px; border: 1px solid #274d32; border-radius: 4px; cursor: pointer; width: 180px; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .btn-copy { background-color: #8b4513; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; width: 400px; font-weight: bold; margin-top: 8px; display: none; }
        .vis-table { width: auto; margin: 15px auto; border-collapse: collapse; background: white; }
        .vis-table th, .vis-table td { border: 1px solid #7d5d3b; padding: 4px 15px; text-align: center; font-size: 12px; }
        .vis-table th { background: #f4e4bc; }
        .launch-time { color: #ff0000; font-weight: bold; }
        .footer-gemini { text-align: center; margin-top: 12px; font-size: 10px; font-weight: bold; color: #8b4513; padding-top: 15px; border-top: 1px dashed #8b4513; }
        #custom-alert { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #8b0000; color: white; padding: 20px; border: 3px solid #ff0000; border-radius: 10px; z-index: 10000; font-weight: bold; text-align: center; }
    </style>
</head>
<body>

<div id="custom-alert">Î¤Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Ï„Î¿Î½ ÎµÏ‡ÎµÎ¹ Î¿ feng. ÎºÏÏ…Î¼Î­Î½Î¿ ÏƒÏ„Î¿ 001 Ï‡Ï‰ÏÎ¹ÏŒ</div>

<div class="container">
    <div class="header-feng">
        <h2>Attact + fake plan by feng for my friends<br>
        <span style="font-size: 12px; font-weight: normal; opacity: 0.8;">(ÎšÏÎ´Î¹ÎºÎ±Ï‚ on Shinko to Kuma)</span></h2>
    </div>
    
    <div id="date_display"></div>

    <h2 style="text-align: center; font-size: 14px; color: #5d2e0d; margin-top: 0;">Î•Ï€Î¹ÎºÏŒÎ»Î·ÏƒÎ· Î»Î¯ÏƒÏ„Î±Ï‚ Ï‡Ï‰ÏÎ¹ÏÎ½ Î±Ï€ÏŒ Ï„Î¿ profil Ï€Î±Î¹ÎºÏ„Î· (Î¦Î¹Î»Ï„ÏÎ¬ÏÎµÎ¹ Î¼ÏŒÎ½Î¿ ÏƒÏ…Î½Ï„ÎµÏ„Î±Î³Î¼Î­Î½ÎµÏ‚)</h2>
    <h2 style="text-align: center; font-size: 14px; color: #5d2e0d; margin-top: 0;">Î•Ï€Î¹ÎºÏŒÎ»Î·ÏƒÎ· Î±Ï€Î¿ <a href="https://forum.fyletikesmaxes.gr/index.php?threads/30012/" target="_blank" style="color: #8b4513; text-decoration: none; font-weight: bold;">Map script</a> Î® Î¼Îµ Ï„Î¿ Ï‡Î­ÏÎ¹ 6 Î±ÏÎ¹Î¸Î¼Î¿ÏÏ‚</h2>

    <div class="inline-row">
        <label>Î†Ï†Î¹Î¾Î·:</label>
        <input type="text" id="datetimepicker" style="width:130px;" readonly>

        <label>ÎœÎ¿Î½Î¬Î´Î±:</label>
        <select id="unit">
            <option value="30" selected>ÎšÏÎ¹ÏŒÏ‚</option>
            <option value="35">Î‘ÏÎ¹ÏƒÏ„Î¿ÎºÏÎ¬Ï„Î·Ï‚</option>
            <option value="9">Î‘Î½Î¹Ï‡Î½ÎµÏ…Ï„Î®Ï‚</option>
            <option value="11">Î’Î±ÏÏ</option>
            <option value="10">Î Î±Î»Î±Î½Ï„Î¯Î½</option>
            <option value="18">Î”ÏŒÏÏ…</option>
            <option value="22">ÎÎ¯Ï†Î¿Ï‚</option>
        </select>

        <label>Î¤M:</label>
        <input type="text" id="unit_speed_display" class="small-input" value="0.625" readonly>
        <input type="hidden" id="unit_speed" value="0.625">

        <label style="background:#fce4ec; padding:2px 8px; border-radius:4px;">
            <label style="color:#d63384;">ğŸ’¤ ÎÏ€Î½Î¿Ï‚:</label>
            <select id="sleep_from" class="sleep-select">
                <option value="0">00:00</option>
                <option value="23">23:00</option>
            </select>
            <label>-</label>
            <select id="sleep_to" class="sleep-select">
                <option value="24" selected>24:00</option>
            </select>   
        </label>

        <label style="background:#fce4ec; padding:2px 8px; border-radius:4px;">
            <input type="checkbox" id="no_sleep" checked> <b>Î”ÎµÎ½ ÎºÎ¿Î¹Î¼Î¬Î¼Î±Î¹</b>
        </label>
    </div>

    <div style="display: flex; gap: 15px; align-items: center; justify-content: center; margin: 20px 0;">  
        <div style="flex: 1; text-align: right;">
            <textarea id="sources" oninput="autoCoord(this)" placeholder="Î”Î¹ÎºÎ¬ Î¼Î¿Ï… Ï‡Ï‰ÏÎ¹Î¬..."></textarea>
        </div>

        <div style="text-align: center; min-width: 150px; padding: 10px; border: 1px dashed #8b4513; border-radius: 8px; background: rgba(139, 69, 19, 0.05);">
            <label style="display: block; font-weight: bold; margin-bottom: 8px; font-size: 13px;">ÎšÎŸÎ£ÎœÎŸÎ£</label>
            <select id="world_speed" style="width: 100%; font-weight: bold; padding: 5px;" onchange="updateSpeeds(this.value)">
                <option value="1.6" data-m="0.625" selected>K104 (1.6/0.625)</option>
                <option value="2.0" data-m="0.5">K100 (2.0/0.5)</option>
                <option value="1.0" data-m="1.0">K101 (1.0/1.0)</option>
                <option value="1.2" data-m="0.8">K102 (1.2/0.8)</option>
            </select>
        </div>

        <div style="flex: 1; text-align: left;">
            <textarea id="targets" oninput="autoCoord(this)" placeholder="Î£Ï„ÏŒÏ‡Î¿Î¹..."></textarea>
        </div>
    </div>

    <p align="center">
        <button class="btn-calc" onclick="calculatePlan()">Î¦Î¤Î™Î‘ÎÎ• Î Î›Î‘ÎÎŸ</button><br>
        <button id="copyBtn" class="btn-copy" onclick="copyToClipboard()">ğŸ“‘ Î‘ÎÎ¤Î™Î“Î¡Î‘Î¦Î— BB-CODE Ï„Î±Î¾Î¹Î½Î¿Î¼Î·Î¼Î­Î½Î± ÎºÎ±Ï„Î¬ ÏÏÎ±</button>
    </p>

    <div id="results_container" style="text-align: center;">
        <div id="results_table"></div>
    </div>

    <div class="footer-gemini">âœ¨ Î’Î¿Î·Î¸Î¬ÎµÎ¹ Î¿ <a href="#" style="color: #8b4513; text-decoration: none;">Gemini 3 AI</a></div>
</div>

<script>
function autoCoord(el) {
    let raw = el.value;
    let processed = raw.replace(/\b(\d{3})(\d{3})\b/g, '$1|$2\n').replace(/[^0-9|\n]/g, '');
    if (raw !== processed) el.value = processed;
}

function updateServerTime() {
    var t = new Date();
    document.getElementById('date_display').innerHTML = "ÎÏÎ± server: " + ("0" + t.getHours()).slice(-2) + ":" + ("0" + t.getMinutes()).slice(-2) + ":" + ("0" + t.getSeconds()).slice(-2);
}
setInterval(updateServerTime, 1000);

$(function() { 
    $('#datetimepicker').datetimepicker({ dateFormat: 'dd/mm/yy', timeFormat: 'HH:mm:ss' }).datetimepicker('setDate', new Date()); 
});

function calculatePlan() {
    const hitTimeStr = $('#datetimepicker').val();
    const parts = hitTimeStr.match(/(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2}):(\d{2})/);
    const hitTimeMs = new Date(parts[3], parts[2]-1, parts[1], parts[4], parts[5], parts[6]).getTime();
    
    const unitValue = parseFloat($('#unit').val());
    const unitIcon = unitValue === 9 ? "spy" : (unitValue === 35 ? "snob" : (unitValue === 10 ? "knight" : (unitValue === 11 ? "heavy" : (unitValue === 18 ? "spear" : (unitValue === 22 ? "sword" : "ram")))));    
    const msPerField = (unitValue / (parseFloat($('#world_speed').val()) * parseFloat($('#unit_speed').val()))) * 60 * 1000;
    
    const sources = $('#sources').val().trim().split('\n'), targets = $('#targets').val().trim().split('\n');
    const sFrom = parseInt($('#sleep_from').val()), sTo = parseInt($('#sleep_to').val()), isNoSleep = $('#no_sleep').is(':checked');
    let attacks = [];

    sources.forEach(s => {
        targets.forEach(t => {
            const sC = s.match(/(\d+)\|(\d+)/), tC = t.match(/(\d+)\|(\d+)/);
            if (sC && tC) {
                const dist = Math.sqrt(Math.pow(sC[1]-tC[1], 2) + Math.pow(sC[2]-tC[2], 2));
                const lMs = hitTimeMs - (dist * msPerField);
                const d = new Date(lMs);
                if (!isNoSleep) {
                    const lHour = d.getHours();
                    if (sFrom < sTo) { if (lHour >= sFrom && lHour < sTo) return; }
                    else { if (lHour >= sFrom || lHour < sTo) return; }
                }
                const lStr = ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2) + ":" + ("0" + d.getSeconds()).slice(-2) + " " + ("0" + d.getDate()).slice(-2) + "/" + ("0" + (d.getMonth() + 1)).slice(-2);
                attacks.push({ from: sC[0], to: tC[0], lMs: lMs, lStr: lStr });
            }
        });
    });

    attacks.sort((a, b) => a.lMs - b.lMs);

    let tableHtml = `<div style="font-weight:bold; margin-bottom:5px; font-size:12px;">Î£ÏÎ½Î¿Î»Î¿ Î•Î½Ï„Î¿Î»ÏÎ½: ${attacks.length}</div><table class="vis-table"><tr><th>Î‘/Î‘</th><th>Î‘Ï€ÏŒ</th><th>Î ÏÎ¿Ï‚</th><th>Î•ÎºÎºÎ¯Î½Î·ÏƒÎ·</th></tr>`;
    let bb = "";
    attacks.forEach((att, index) => {
        tableHtml += `<tr><td>${index + 1}</td><td>${att.from}</td><td>${att.to}</td><td class="launch-time">${att.lStr}</td></tr>`;
        bb += `${index + 1}. [unit]${unitIcon}[/unit] [coord]${att.from}[/coord] -> [coord]${att.to}[/coord] | [b][color=#ff0000]${att.lStr}[/color][/b]\n`;
    });

    $('#results_table').html(tableHtml + "</table>");
    $('#bbcopy').remove(); 
    $('body').append(`<textarea id="bbcopy" style="display:none;">${bb}</textarea>`);
    $('#copyBtn').show();
}

function copyToClipboard() {
    var c = document.getElementById("bbcopy"); 
    c.style.display = "block"; c.select(); document.execCommand("copy"); c.style.display = "none";
    $("#copyBtn").text("âœ… Î‘ÎÎ¤Î™Î“Î¡Î‘Î¦Î—ÎšÎ•!"); 
    setTimeout(() => { $("#copyBtn").text("ğŸ“‘ Î‘ÎÎ¤Î™Î“Î¡Î‘Î¦Î— BB-CODE Ï„Î±Î¾Î¹Î½Î¿Î¼Î·Î¼Î­Î½Î± ÎºÎ±Ï„Î¬ ÏÏÎ±"); }, 2000);
}

function updateSpeeds(val) {
    const m = $('#world_speed option:selected').data('m');
    $('#unit_speed').val(m);
    $('#unit_speed_display').val(m);
}

document.addEventListener('contextmenu', function(e) {
    if (e.target.tagName === 'TEXTAREA') return true;
    e.preventDefault();
    $('#custom-alert').fadeIn().delay(2000).fadeOut();
});
</script>
</body>
</html>
